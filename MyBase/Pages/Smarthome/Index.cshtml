@page
@model MyBase.Pages.SmartHome.IndexModel
@{
    ViewData["Title"] = "Smarthome";
}

<main class="smarthome-page">
    <h2>🏠 Smarthome</h2>

    <!-- Grid: Systeminfo + Geräteverwaltung -->
    <div class="smarthome-top-grid">
        <div class="smarthome-device-card">
            <h4 class="device-title">📊 Systeminfo</h4>
            <p>⚙️ <strong>Admin Adapter:</strong> @(Model.AdminAlive ?? "-")</p>
            <p>🧠 <strong>Freier RAM:</strong> @(Model.FreeMem ?? "-") MB</p>
        </div>

        <div class="smarthome-device-card">
            <h4 class="device-title">🛠️ Geräteverwaltung</h4>
            <p>Füge neue Geräte hinzu oder bearbeite bestehende Zigbee- oder Pico-Geräte.</p>
            <div class="device-nav-buttons mt-3">
                <a href="/SmartHome/Devices" class="btn btn-secondary">📋 Geräteliste</a>
                <a href="/SmartHome/Devices/Create" class="btn btn-green">➕ Gerät hinzufügen</a>
            </div>
        </div>
    </div>

    <!-- Geräte aus DB anzeigen -->
    @if (Model.Devices.Any()) {
        <div class="device-card-grid">
            @foreach (var device in Model.Devices) {
                <div class="smarthome-device-card">
                    <h4 class="device-title">@device.Name</h4>
                    <p class="text-muted">Typ: @device.Type / @device.ControlType</p>

                    @if (device.ControlType == "switch") {
                        <form method="post" asp-page-handler="ToggleDevice" asp-route-id="@device.Id">
                            <button type="submit" class="btn btn-green">Wechseln</button>
                        </form>
                    } else if (device.ControlType == "slider") {
                        <form method="post" asp-page-handler="SetSlider" asp-route-id="@device.Id">
                            <input type="range" name="value" min="@device.Min" max="@device.Max" />
                            <button type="submit" class="btn btn-secondary mt-1">Übernehmen</button>
                        </form>
                    } else if (device.ControlType == "display") {
                        <p><strong>Wert:</strong> (noch nicht implementiert)</p>
                    }

                    <p class="device-endpoint mt-2 text-sm"><code>@device.Endpoint</code></p>
                </div>
            }
        </div>
    }
</main>
